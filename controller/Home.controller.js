sap.ui.define(["./Basecontroller","sap/ui/core/Fragment","sap/m/MessageToast","sap/ui/model/Sorter","../model/Pomodoro.model","../model/Task.model","../model/Config.model","../model/formatter"],function(t,e,s,i,o,a,n,d){"use strict";return t.extend("sap.ui.demo.basicTemplate.controller.Home",{formatter:d,async onInit(){o.init();o.tie(this);o.setProperty("/settings/notification/desktopNotification",await this.requestNotificationPermission());a.syncHistory();a.tie(this);this.handleSetUserTheme()},handleToggleTimer(){const{ticking:t}=o.getProperty("/timer");if(t){s.show("Timer stopped");return o.stopTicking()}if(!t){s.show("Timer started");return o.startTicking(this)}},handleFinishCurrentPhase(){const{status:t,taskEstimation:e}=o.getData();const{msTotal:i}=n.getProperty("/settings/minFocus");const{desktopNotification:d}=n.getProperty("/settings/notification");const{ticking:r,msExpired:l,counter:g}=o.getProperty("/timer");if(r&&t.isWorking&&l<i){s.show(`Focus for at least ${(i/6e4).toFixed(0)} minutes!`)}else{o.stopTicking();o.increaseCounter(1);o.setStatusNext();if(l>i||!t.isWorking){const{task:i}=a.getData();i.status=t;i.msExpired=l;i.msEstimated=e*36e5;a.addToHistory({...i});s.show("Phase completed");if(d){this.sendNotification("Phase completed",{body:`${(l/6e4).toFixed(0)} minute/s passed. Click here and jump into the next phase`})}}else{s.show("Phase skipped")}}},handleResetCurrentPhase(){o.stopTicking();o.setStatusPrevious()},handleCreateNewTask(){const{task:t,taskEstimation:e}=a.getData();t.status={isWorking:true,isPausing:false};t.msExpired=0;t.msEstimated=e*36e5;a.addToHistory({...t});s.show("Task added to tasklist.");this.handleCloseTaskDialog()},handleUpdateTaskByTaskPath(){a.updateTaskByTaskPath();this.handleCloseTaskEditDialog()},handleOpenTaskDialog(){const t=this.getView();if(!this.byId("task-dialog")){e.load({id:t.getId(),name:"sap.ui.demo.basicTemplate.view.Fragment.Task",controller:this}).then(e=>{t.addDependent(e);e.open()})}else{this.byId("task-dialog").open()}},handleCloseTaskDialog(){const t=this.byId("task-dialog");if(t){t.close()}},handleOpenTaskEditDialog(t){const s=t.getSource();let i;console.log(s);if(s.getSelectedAppointments){console.log(s.getSelectedAppointments());i=s.getSelectedAppointments()[0].getBindingContext("Task").getPath()}else{i=s.getBindingContext("Task").getPath()}const o=a.getProperty(i);o.sPath=i;a.setProperty("/taskEditByUser",o);const n=this.getView();if(!this.byId("task-edit-dialog")){this._taskEditDialog=e.load({id:n.getId(),name:"sap.ui.demo.basicTemplate.view.Fragment.TaskEdit",controller:this}).then(t=>{n.addDependent(t);t.open()})}else{this.byId("task-edit-dialog").open()}},handleCloseTaskEditDialog(){const t=this.byId("task-edit-dialog");if(t){t.close()}},handleSynchronizeHistory(){const t=a.syncHistory();if(t){s.show("Loaded session data from history")}else{s.show("No history data found")}},_groupByDay(t){const e=t.getProperty("startDate");return{key:d.formatStringToDateDay(e),text:d.formatStringToDateDay(e)}},handleApplySorterAndFilter(){const t=[];t.push(new i("startDate",true,this._groupByDay));this.byId("task-table").getBinding("items").sort(t)},_setActiveTaskMsExpired(t){const e=t.getSource().getValue();const s=e*(1e3*60*60).toFixed(0);a.setProperty("/taskEditByUser/msExpired",s)},_setActiveTaskMsEstimated(t){const e=t.getSource().getValue();const s=e*(1e3*60*60).toFixed(0);a.setProperty("/taskEditByUser/msEstimated",s)}})});