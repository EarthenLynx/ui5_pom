sap.ui.define(["./Basecontroller","sap/ui/core/Fragment","sap/m/MessageToast","../model/Pomodoro.model","../model/Task.model","../model/Config.model","../model/formatter"],function(t,e,s,i,o,a,n){"use strict";return t.extend("sap.ui.demo.basicTemplate.controller.Home",{formatter:n,async onInit(){i.init();i.tie(this);i.setProperty("/settings/notification/desktopNotification",await this.requestNotificationPermission());o.syncHistory();o.tie(this);this.handleSetUserTheme()},handleToggleTimer(){const{ticking:t}=i.getProperty("/timer");if(t){s.show("Timer stopped");return i.stopTicking()}if(!t){s.show("Timer started");return i.startTicking(this)}},handleFinishCurrentPhase(){const{status:t,taskEstimation:e}=i.getData();const{msTotal:n}=a.getProperty("/settings/minFocus");const{desktopNotification:d}=a.getProperty("/settings/notification");const{ticking:r,msExpired:l,counter:c}=i.getProperty("/timer");if(r&&t.isWorking&&l<n){s.show(`Focus for at least ${(n/6e4).toFixed(0)} minutes!`)}else{i.stopTicking();i.increaseCounter(1);i.setStatusNext();if(l>n||!t.isWorking){const{task:i}=o.getData();i.status=t;i.msExpired=l;i.msEstimated=e*36e5;o.addToHistory({...i});s.show("Phase completed");if(d){this.sendNotification("Phase completed",{body:`${(l/6e4).toFixed(0)} minute/s passed. Click here and jump into the next phase`})}}else{s.show("Phase skipped")}}},handleResetCurrentPhase(){i.stopTicking();i.setStatusPrevious()},handleCreateNewTask(){const{task:t,taskEstimation:e}=o.getData();t.status={isWorking:true,isPausing:false};t.msExpired=0;t.msEstimated=e*36e5;o.addToHistory({...t});s.show("Task added to history")},handleUpdateTaskByTaskPath(){o.updateTaskByTaskPath();this.handleCloseTaskEditDialog()},handleOpenTaskDialog(){const t=this.getView();if(!this.byId("task-dialog")){e.load({id:t.getId(),name:"sap.ui.demo.basicTemplate.view.Fragment.Task",controller:this}).then(e=>{t.addDependent(e);e.open()})}else{this.byId("task-dialog").open()}},handleCloseTaskDialog(){const t=this.byId("task-dialog");if(t){t.close()}},handleOpenTaskEditDialog(t){const s=t.getSource();let i;console.log(s);if(s.getSelectedAppointments){console.log(s.getSelectedAppointments());i=s.getSelectedAppointments()[0].getBindingContext("Task").getPath()}else{i=s.getBindingContext("Task").getPath()}const a=o.getProperty(i);a.sPath=i;o.setProperty("/taskEditByUser",a);const n=this.getView();if(!this.byId("task-edit-dialog")){this._taskEditDialog=e.load({id:n.getId(),name:"sap.ui.demo.basicTemplate.view.Fragment.TaskEdit",controller:this}).then(t=>{n.addDependent(t);t.open()})}else{this.byId("task-edit-dialog").open()}},handleCloseTaskEditDialog(){const t=this.byId("task-edit-dialog");if(t){t.close()}},handleSynchronizeHistory(){const t=o.syncHistory();if(t){s.show("Loaded session data from history")}else{s.show("No history data found")}},_setActiveTaskMsExpired(t){const e=t.getSource().getValue();const s=e*(1e3*60*60).toFixed(0);o.setProperty("/taskEditByUser/msExpired",s)},_setActiveTaskMsEstimated(t){const e=t.getSource().getValue();const s=e*(1e3*60*60).toFixed(0);o.setProperty("/taskEditByUser/msEstimated",s)}})});